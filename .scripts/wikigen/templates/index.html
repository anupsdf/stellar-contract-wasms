<!DOCTYPE html>
<html>
<head>
    <title>Stellar Contract Wiki</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .contract-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .contract-card { border: 1px solid #ddd; padding: 20px; border-radius: 5px; }
        .contract-card h3 { margin-top: 0; }
        .contract-hash { font-family: monospace; font-size: 12px; color: #666; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .contract-size { font-family: monospace; font-size: 10px; color: #888; margin-top: 4px; }
        .function-names { margin: 10px 0; }
        .function-name { display: inline-block; background: #d4edda; color: #155724; padding: 2px 8px; margin: 2px; border-radius: 3px; font-size: 12px; font-family: monospace; cursor: pointer; transition: background-color 0.2s; }
        .function-name:hover { background: #c3e6cb; }
        .import-name { display: inline-block; background: #fff3cd; color: #856404; padding: 2px 8px; margin: 2px; border-radius: 3px; font-size: 12px; font-family: monospace; cursor: pointer; transition: background-color 0.2s; }
        .import-name:hover { background: #ffeaa7; }
        .source-repo { font-size: 12px; color: #4a5568; margin-top: 8px; }
        .source-repo a { color: #3182ce; text-decoration: none; }
        .source-repo a:hover { text-decoration: underline; }
        .contract-card a { text-decoration: none; }
        .search-container { margin-bottom: 30px; }
        .search-input { width: 100%; max-width: 500px; padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 5px; }
        .search-input:focus { outline: none; border-color: #3182ce; }
        .contract-card.hidden { display: none; }
    </style>
</head>
<body>
    <h1>Stellar Contract Wiki</h1>
    <p id="contract-count">This wiki contains documentation for {{ contracts | length }} contracts.</p>
    
    <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="Search contracts by hash, function names, import names, or source repository..." />
    </div>
    
    <div class="contract-list">
        {% for contract in contracts %}
        <div class="contract-card" data-searchable="{{ contract.function_names | join(sep=" ") }} {{ contract.import_names | join(sep=" ") }} {{ contract.source_repo | default(value="") }} {{ contract.hash }}">
            <a href="{{ contract.hash }}.html">
              <div class="contract-hash">{{ contract.hash }}</div>
              <div class="contract-size">{{ contract.size }}</div>
            </a>
            {% if contract.function_names %}
            <div class="function-names">
                {% for function_name in contract.function_names %}
                <span class="function-name" onclick="searchForFunction('{{ function_name }}')">{{ function_name }}</span>
                {% endfor %}
            </div>
            {% endif %}
            {% if contract.import_names %}
            <div class="import-names">
                {% for import_name in contract.import_names %}
                <span class="import-name" onclick="searchForFunction('{{ import_name }}')">{{ import_name }}</span>
                {% endfor %}
            </div>
            {% endif %}
            {% if contract.source_repo %}
            <div class="source-repo">
                {% if contract.source_repo is starting_with("github:") %}
                <a href="https://github.com/{{ contract.source_repo | replace(from="github:", to="") }}" target="_blank">üìÅ {{ contract.source_repo }}</a>
                {% elif contract.source_repo is starting_with("http://") or contract.source_repo is starting_with("https://") %}
                <a href="{{ contract.source_repo }}" target="_blank">üìÅ {{ contract.source_repo }}</a>
                {% else %}
                <a href="https://github.com/{{ contract.source_repo }}" target="_blank">üìÅ {{ contract.source_repo }}</a>
                {% endif %}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <script>
        const totalContracts = {{ contracts | length }};

        function updateContractCount() {
            const visibleCards = document.querySelectorAll('.contract-card:not(.hidden)');
            const countElement = document.getElementById('contract-count');

            if (visibleCards.length === totalContracts) {
                countElement.textContent = `This wiki contains documentation for ${totalContracts} contracts.`;
            } else {
                countElement.textContent = `Displaying ${visibleCards.length} of ${totalContracts} contracts.`;
            }
        }

        function searchForFunction(functionName) {
            const searchInput = document.getElementById('searchInput');
            searchInput.value = functionName;
            searchInput.focus();

            // Trigger the search
            const event = new Event('input', { bubbles: true });
            searchInput.dispatchEvent(event);
        }

        document.getElementById('searchInput').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase().trim();
            const contractCards = document.querySelectorAll('.contract-card');

            if (searchTerm === '') {
                // Show all contracts if search is empty
                contractCards.forEach(card => {
                    card.classList.remove('hidden');
                });
            } else {
                // Split search term into individual words
                const searchWords = searchTerm.split(/\s+/).filter(word => word.length > 0);

                contractCards.forEach(card => {
                    const searchableText = card.getAttribute('data-searchable').toLowerCase();

                    // Check if all search words are present in the searchable text
                    const containsAllWords = searchWords.every(word => searchableText.includes(word));

                    if (containsAllWords) {
                        card.classList.remove('hidden');
                    } else {
                        card.classList.add('hidden');
                    }
                });
            }

            // Update the count display
            updateContractCount();
        });

        // Initialize the count on page load
        updateContractCount();
    </script>
</body>
</html>
